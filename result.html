<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>GPTRIP - ê²€ìƒ‰ ê²°ê³¼</title>
<script src="https://cdn.tailwindcss.com/3.4.16">
async function fetchPlaceDetailUrl(query) {
  const response = await fetch(`https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(query)}`, {
    headers: {
      Authorization: 'KakaoAK 4d266e6f76ea88c89c25db7d61c36b8d'
    }
  });

  const data = await response.json();
  if (data.documents && data.documents.length > 0) {
    const placeId = data.documents[0].id;
    return `https://place.map.kakao.com/${placeId}`;
  }
  return null;
}

</script>
<script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1e88e5',
            secondary: '#4a90e2'
          },
          borderRadius: {
            'button': '8px'
          }
        }
      }
    };
  
async function fetchPlaceDetailUrl(query) {
  const response = await fetch(`https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(query)}`, {
    headers: {
      Authorization: 'KakaoAK 4d266e6f76ea88c89c25db7d61c36b8d'
    }
  });

  const data = await response.json();
  if (data.documents && data.documents.length > 0) {
    const placeId = data.documents[0].id;
    return `https://place.map.kakao.com/${placeId}`;
  }
  return null;
}

</script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&amp;display=swap" rel="stylesheet"/>
<style>
    .card-selected {
      border-bottom: 4px solid #3b82f6;
    }
    .category-btn.active {
      background-color: #1e70c9;
      color: white;
    }
  
  .category-scroll {
    display: flex !important;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    gap: 1rem;
    padding-bottom: 1rem;
  }

  .category-slide-card {
    flex: 0 0 auto;
    width: 250px;
    scroll-snap-align: start;
  }


.scroll-container {
  cursor: grab;
}
.cursor-grabbing {
  cursor: grabbing !important;
}

</style>
<style>
  .scroll-container {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    gap: 1rem;
    padding-bottom: 1rem;
  }

  .scroll-container::-webkit-scrollbar {
    height: 8px;
  }

  .scroll-container::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 4px;
  }

  .slide-card {
    flex: 0 0 auto;
    width: 250px;
    scroll-snap-align: start;
  }

  .category-scroll {
    display: flex !important;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    gap: 1rem;
    padding-bottom: 1rem;
  }

  .category-slide-card {
    flex: 0 0 auto;
    width: 250px;
    scroll-snap-align: start;
  }

</style>
</head>
<body class="bg-gray-50">
<header class="bg-primary text-white w-full py-4 px-6">
<div class="container mx-auto flex justify-between items-center">
<a class="text-2xl font-['Pacifico'] text-white" href="#">GPTRIP</a>
<nav>
<ul class="flex space-x-8">
</ul></nav>
</div>
</header>
<main class="max-w-6xl mx-auto px-4 py-6">
<div class="flex items-center gap-4 mb-6"><h1 class="text-2xl font-bold">ì¶”ì²œëœ ì—¬í–‰ì§€</h1><button class="bg-primary text-white px-4 py-2 rounded-button shadow hover:bg-blue-700 transition" onclick="location.href='insert.html'">ğŸ” ë‹¤ì‹œ ì…ë ¥í•˜ëŸ¬ ê°€ê¸°</button></div><section class="bg-white shadow p-4 mb-6 rounded-md border border-gray-200">
<h2 class="text-lg font-semibold mb-2">ì…ë ¥í•œ ê²€ìƒ‰ ì •ë³´</h2>
<div class="text-sm text-gray-600">
<p><strong>ì´ë¯¸ì§€ ì…ë ¥:</strong></p>
<img alt="ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°" class="mt-2 rounded shadow-md max-w-xs" id="uploaded-image"/>
<p class="mt-2" id="text-prompt-dynamic"></p>
</div>
</section>
<div class="scroll-container mb-8" id="recommend-card-container"></div>
<section class="mb-8">
<h2 class="text-xl font-bold mb-4">ì§€ë„ì—ì„œ ë³´ê¸°</h2>
<div class="flex mb-4 space-x-2">
<button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-button category-btn" data-category="ì¹´í˜">ì¹´í˜</button>
<button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-button category-btn" data-category="ìŒì‹">ìŒì‹</button>
<button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-button category-btn" data-category="ê´€ê´‘">ê´€ê´‘</button>
</div>
<div class="h-96 rounded-lg mb-6" id="kakao-map" style="z-index:0;"></div>
<!-- ì¤‘ë³µëœ div ì œê±° -->
</section>
<div class="category-scroll mb-10" id="category-card-container" style="position:relative; z-index:10;"></div>
</main>
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=94741a4d3bbfb347716567a7d6392c77&amp;libraries=services">
async function fetchPlaceDetailUrl(query) {
  const response = await fetch(`https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(query)}`, {
    headers: {
      Authorization: 'KakaoAK 4d266e6f76ea88c89c25db7d61c36b8d'
    }
  });

  const data = await response.json();
  if (data.documents && data.documents.length > 0) {
    const placeId = data.documents[0].id;
    return `https://place.map.kakao.com/${placeId}`;
  }
  return null;
}

</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
      const data = JSON.parse(localStorage.getItem('recommendation_result') || '[]');
      const cardGrid = document.getElementById('recommend-card-container');
      const mapContainer = document.getElementById('kakao-map');
      const categoryCardContainer = document.getElementById('category-card-container');
      const activeMarkers = { ì¹´í˜: [], ìŒì‹: [], ê´€ê´‘: [] };
      let selectedCard = null;
      let selectedPlace = null;
      let activeCategory = null;

      if (!Array.isArray(data) || !mapContainer) return;

      const map = new kakao.maps.Map(mapContainer, {
        center: new kakao.maps.LatLng(data[0].mapy, data[0].mapx),
        level: 5
      });

      cardGrid.innerHTML = '';

      data.forEach((place, index) => {
        const card = document.createElement("div");
        card.className = "slide-card bg-white rounded shadow-md overflow-hidden cursor-pointer hover:bg-blue-50 transition";
        card.innerHTML = `
          <img src="${place.image || 'https://via.placeholder.com/250x150?text=No+Image'}" alt="${place.title}" class="w-full h-40 object-cover">
          <div class="p-4">
            <h3 class="font-bold text-lg mb-1">${place.title}</h3>
            <p class="text-gray-500 text-sm mb-3 italic">${place.emotional_summary}</p>
            <p class="text-gray-600 text-sm mb-2">ì£¼ì†Œ: ${place.addr1}</p>
            <p class="text-gray-600 text-sm mb-2">ì „í™”: ${place.tel || 'ì •ë³´ ì—†ìŒ'}</p>
            <p class="text-xs text-gray-400 italic mt-2">â€»ë”ë¸”í´ë¦­ ì‹œ ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ì´ë™</p>
          </div>`;

        card.addEventListener('click', () => {
          if (selectedCard) selectedCard.classList.remove("card-selected");
          card.classList.add("card-selected");
          selectedCard = card;
          selectedPlace = place;
          map.setCenter(new kakao.maps.LatLng(place.mapy, place.mapx));
        card.addEventListener('dblclick', () => {
          window.open(place.place_url, '_blank');
        });

  // âœ… ì¶”ì²œ ì¥ì†Œ í´ë¦­ ì‹œ ì¹´í…Œê³ ë¦¬ ìƒíƒœ ì´ˆê¸°í™”
  Object.keys(activeMarkers).forEach(key => {
    activeMarkers[key].forEach(marker => marker.setMap(null));
    activeMarkers[key] = [];
  });
  document.querySelectorAll(".category-btn").forEach(btn => btn.classList.remove("active"));
  categoryCardContainer.innerHTML = '';
  activeCategory = null;

        });

        cardGrid.appendChild(card);

        const markerImage = new kakao.maps.MarkerImage(
          'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png',
          new kakao.maps.Size(24, 35)
        );

        new kakao.maps.Marker({
          map: map,
          position: new kakao.maps.LatLng(place.mapy, place.mapx),
          title: place.title,
          image: markerImage
        });
      });

      
document.querySelectorAll(".category-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const category = btn.dataset.category;

    if (!selectedPlace) {
      alert("ë¨¼ì € ì—¬í–‰ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");
      return;
    }

    if (activeCategory === category) {
      // âœ… ê°™ì€ ë²„íŠ¼ ë‹¤ì‹œ ëˆ„ë¥´ë©´ í† ê¸€ OFF
      btn.classList.remove("active");
      activeMarkers[category].forEach(marker => marker.setMap(null));
      activeMarkers[category] = [];
      categoryCardContainer.innerHTML = '';
      categoryCardContainer.style.display = 'none';
      activeCategory = null;
      return;
    }

    // âœ… í† ê¸€ ON: ê¸°ì¡´ ê²ƒë“¤ ì´ˆê¸°í™” í›„ ìƒˆë¡œ í‘œì‹œ
    document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    Object.keys(activeMarkers).forEach(key => {
      activeMarkers[key].forEach(marker => marker.setMap(null));
      activeMarkers[key] = [];
    });

    categoryCardContainer.innerHTML = '';
    categoryCardContainer.style.display = 'grid';

    let query = category === "ì¹´í˜" ? "ì¹´í˜" : category === "ìŒì‹" ? "ë§›ì§‘" : "ê´€ê´‘ì§€";

    const ps = new kakao.maps.services.Places();
    ps.keywordSearch(query, (result, status) => {

            if (status !== kakao.maps.services.Status.OK) {
              alert("ì¥ì†Œ ê²€ìƒ‰ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
              return;
            }

            console.log('ê²€ìƒ‰ëœ ì¥ì†Œ:', result);

            if (!result.length) {
              categoryCardContainer.innerHTML = '<p class="text-center text-gray-500 col-span-full">ğŸ˜¥ ì£¼ë³€ ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
              return;
            }

            const places = result.slice(0, 5);
            places.forEach(place => {
              console.log('ì¹´ë“œ ëŒ€ìƒ ì¥ì†Œ:', place);
              const marker = new kakao.maps.Marker({
                map: map,
                position: new kakao.maps.LatLng(place.y, place.x),
                title: place.place_name
              });
              activeMarkers[category].push(marker);

              const infowindow = new kakao.maps.InfoWindow({
                content: `<div style="padding:5px;font-size:13px;">ğŸ“ ${place.place_name}</div>`
              });

              kakao.maps.event.addListener(marker, 'mouseover', () => infowindow.open(map, marker));
              kakao.maps.event.addListener(marker, 'mouseout', () => infowindow.close());

              const card = document.createElement('div');
              card.className = 'category-slide-card bg-white border rounded shadow p-4';
              card.innerHTML = `
                <h4 class="font-bold text-lg mb-1">ğŸ“ ${place.place_name}</h4>
                <p class="text-sm text-gray-600 mb-1">ğŸ“ ${place.road_address_name || place.address_name}</p>
                <p class="text-sm text-gray-500">ğŸ“ ${place.phone || 'ì „í™”ë²ˆí˜¸ ì—†ìŒ'}</p>
                <p class="text-xs text-gray-400 italic mt-2">â€»ë”ë¸”í´ë¦­ ì‹œ ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ì´ë™</p>              `;
              
  // âœ… í´ë¦­ ì‹œ ì§€ë„ ì¤‘ì‹¬ ì´ë™ + ì¹´ë“œ ìŠ¤íƒ€ì¼ ì ìš©
  card.addEventListener('click', () => {
    map.setCenter(new kakao.maps.LatLng(place.y, place.x));
    if (selectedCard) selectedCard.classList.remove("card-selected");
    card.classList.add("card-selected");
    selectedCard = card;
  });

  card.addEventListener('dblclick', async () => {
    const url = await fetchPlaceDetailUrl(place.place_name);
    if (url) {
      window.open(url, '_blank');
    } else {
      alert('ì¥ì†Œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
  });


  categoryCardContainer.appendChild(card);
              console.log('ì¹´ë“œ ì¶”ê°€ë¨:', place.place_name);
            });
            activeCategory = category;
            categoryCardContainer.scrollIntoView({ behavior: 'smooth' });
          }, {
            location: new kakao.maps.LatLng(selectedPlace.mapy, selectedPlace.mapx),
            radius: 1000
          });
            
        });
      });

      const imgEl = document.getElementById('uploaded-image');
      const promptEl = document.getElementById('text-prompt-dynamic');
      const base64 = localStorage.getItem('user_image_base64');
      const prompt = localStorage.getItem('user_text_prompt');

      if (imgEl && base64) imgEl.src = base64;
      if (promptEl && prompt) {
        promptEl.innerHTML = "<strong>í…ìŠ¤íŠ¸ ì…ë ¥:</strong> " + prompt;
      }
    });
  
async function fetchPlaceDetailUrl(query) {
  const response = await fetch(`https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(query)}`, {
    headers: {
      Authorization: 'KakaoAK 4d266e6f76ea88c89c25db7d61c36b8d'
    }
  });

  const data = await response.json();
  if (data.documents && data.documents.length > 0) {
    const placeId = data.documents[0].id;
    return `https://place.map.kakao.com/${placeId}`;
  }
  return null;
}

</script>
<footer class="bg-gray-100 text-center py-3 text-sm text-gray-600 shadow" style="">
  ë¬¸ì˜ ì‚¬í•­ì´ ìˆìœ¼ì‹œë‹¤ë©´ 
  <a class="text-primary underline" href="mailto:pino017234@gmail.com">
    pino017234@gmail.com
  </a> ìœ¼ë¡œ ë©”ì¼ ì£¼ì„¸ìš”.
</footer>

<script>
  const scrollContainer = document.querySelector('.scroll-container');
  let isDown = false;
  let startX;
  let scrollLeft;

  scrollContainer.addEventListener('mousedown', (e) => {
    isDown = true;
    scrollContainer.classList.add('cursor-grabbing');
    startX = e.pageX - scrollContainer.offsetLeft;
    scrollLeft = scrollContainer.scrollLeft;
  });

  scrollContainer.addEventListener('mouseleave', () => {
    isDown = false;
    scrollContainer.classList.remove('cursor-grabbing');
  });

  scrollContainer.addEventListener('mouseup', () => {
    isDown = false;
    scrollContainer.classList.remove('cursor-grabbing');
  });

  scrollContainer.addEventListener('mousemove', (e) => {
    if (!isDown) return;
    e.preventDefault();
    const x = e.pageX - scrollContainer.offsetLeft;
    const walk = (x - startX) * 1.5;
    scrollContainer.scrollLeft = scrollLeft - walk;
  });

async function fetchPlaceDetailUrl(query) {
  const response = await fetch(`https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(query)}`, {
    headers: {
      Authorization: 'KakaoAK 4d266e6f76ea88c89c25db7d61c36b8d'
    }
  });

  const data = await response.json();
  if (data.documents && data.documents.length > 0) {
    const placeId = data.documents[0].id;
    return `https://place.map.kakao.com/${placeId}`;
  }
  return null;
}

</script>

</body>
</html>
